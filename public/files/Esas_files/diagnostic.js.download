
/**
 * Name: OnlineDiagnose
 *
 * Copyright © 2013-2018 Ильин Олег
 */

jQuery(function(){var a={getQueryGET:function(){var a=[],b=jQuery("#limitIllness").val()||30,c=jQuery("#limitSymptome").val()||.01,d=jQuery("#diag_age"),e=d.length?d.prop("checked")?1:0:1,f=jQuery("#diag_ratio_op").prop("checked")?1:0;return a.push("limit_ill="+b),a.push("limit_sym="+c),a.push("age_d="+e),a.push("diag_ratio_op="+f),a.join("&")},clearCash:function(){jQuery.ajax({type:"GET",url:"index.php?option=com_socdiagnostics&controller=ajaxdiagnostics&task=clear_cash",success:function(){alert("Данные из кеша удалены")}})}},b=function(){var a=[];this.setItem=function(b){a.push(b)},this.isHistory=function(){return a.length},this.getItem=function(){var b=a.length;return b>1?(a.length=b-1,a[a.length-1]||!1):!1},this.clear=function(){a=[]}},c=function(){var a={},b="loc_";this.add=function(c,d){a[b+c]=d},this.get=function(c){var d=b+c;return _.has(a,d)?a[d]:!1},this.has=function(c){var d=b+c;return _.has(a,d)?!0:!1}},d=function(){"use strict";var a=jQuery("#bcd_sex"),b=(jQuery("#bcd_sex_sep"),jQuery("#bcd_loc")),c=jQuery("#bcd_loc_sep"),d=jQuery("#bcd_dia"),e=jQuery("#bcd_dia_sep"),f=function(a,b,c){jQuery(a).fadeOut("fast",function(){c&&c(),jQuery(b).fadeIn()})},g=function(){Medical.ModelIllness.reset(),Medical.ModelLocalization.reset(),Medical.ModelSymptome.cancel()};this.selectStepGender=function(){0!==Medical.Settings.page&&(jQuery("#wrapSex").fadeIn(),a.html("Пол и возраст").addClass("active"),b.removeClass("active").hide(),c.hide(),d.removeClass("active").hide(),e.hide(),jQuery("#screen_location, #screen_basket").hide(),Medical.Settings.page=0,g(),jQuery("#alarm-global").hide())},this.goToLocation=function(){var g,h,i=Medical.ControllerSteps,j=jQuery(".wrap-inner-sex .select-gender"),k=j.attr("id"),l=jQuery("input[name=age_patient]:checked"),m=l.val(),n=l.next().html(),o=!1;1!==j.length?(i.toogleToolTip("#toolTipGender","show"),o=!0):i.toogleToolTip("#toolTipGender","hide"),g=i.isDigit(jQuery("#weight_patient").val()),g!==!1&&g>0&&180>=g?(jQuery("#weight_patient").val(g),i.toogleToolTip("#toolTipWeight","hide")):(o=!0,i.toogleToolTip("#toolTipWeight","show")),h=i.isDigit(jQuery("#growth_patient").val()),h!==!1&&h>0&&250>=h?(jQuery("#growth_patient").val(h),i.toogleToolTip("#toolTipGrowth","hide")):(o=!0,i.toogleToolTip("#toolTipGrowth","show")),o||(Medical.ModelIllness.setAge(m),Medical.ModelSelectLoc.setAge(m),Medical.ModelSymptome.setAge(m),Medical.ModelSelectLoc.setSide("front"),a.removeClass("active").html(("sex_man"===k?"Мужчина (":"Женщина (")+n+")"),b.addClass("active").show(),c.show(),d.removeClass("active").hide(),e.hide(),f("#wrapSex","#screen_location",Medical.ModelSelectLoc.show),Medical.Settings.page=1,jQuery("#alarm-global").show())},this.toogleToolTip=function(a,b){"hide"===b?jQuery(a).hide():jQuery(a).show()},this.isDigit=function(a){var b=parseFloat(a.replace(",","."));return isNaN(b)?!1:b},this.selectGender=function(){var a=jQuery(this),b=a.attr("id");jQuery(".wrap-inner-sex .btnSex").removeClass("select-gender"),a.addClass("select-gender"),Medical.ModelIllness.setGender(b),Medical.ModelSelectLoc.setGender(b),Medical.ModelSymptome.setGender(b)},this.selectStepLocation=function(){1!==Medical.Settings.page&&(jQuery("#screen_location").fadeIn(),jQuery("#screen_basket, #bcd_dia, #bcd_dia_sep").hide(),a.removeClass("active"),b.addClass("active").show(),c.show(),d.removeClass("active").hide(),e.hide(),Medical.Settings.page=1,g(),Medical.ModelSelectLoc.setSide("front"),Medical.ModelSelectLoc.show())},this.selectNewLocation=function(){1!==Medical.Settings.page&&(jQuery("#screen_location").fadeIn(),jQuery("#screen_basket").hide(),Medical.Settings.page=1,a.removeClass("active"),b.addClass("active").show(),d.removeClass("active"),jQuery("#stack-btnadd-symptome").hide(),Medical.ModelSelectLoc.setSide("front"),Medical.ModelSelectLoc.show())},this.seletStepDiagnostic=function(){2!==Medical.Settings.page&&(f("#screen_location","#screen_basket"),a.removeClass("active"),b.removeClass("active"),d.addClass("active").show(),e.show(),Medical.Settings.page=2)}},e=function(){function a(){var a=Medical.Settings.base_uri+"body_all_"+q+"_"+o+".png";jQuery(j).html("<img id='img_location' alt='' src='"+a+"' usemap='#location_map' />")}function b(a){e();var b=r+"_"+o+"_"+q;if(t.has(b))return void d(b,a);var c=Array("gender="+q,"side="+o,"parent="+r,"age="+p);jQuery.ajax({type:"POST",url:"index.php?option=com_socdiagnostics&controller=ajaxlocation&task=get_location",data:c.join("&"),success:function(c){var e={rc:-1,msg:""};try{e=jQuery.parseJSON(c)}catch(f){e={rc:-1,msg:f.toString()}}1===e.rc&&(t.add(b,e),d(b,a))},error:function(){f(a)}})}function d(a,b){var c=t.get(a),d=[];c&&(s=c.parent,d=c.data.copy().reverse(),b&&c.img&&jQuery(j).html("<img id='img_location' alt='' src='"+Medical.Settings.base_uri+c.img+"' usemap='#location_map' />"),h.html(k({locations:c.data,otherloc:c.other})),jQuery("#location_map").html(l({datapoly:d})),g(),f(b))}function e(){h.hide(),i.removeClass("border"),i.nanoScroller({destroy:!0}),n.show()}function f(){n.hide();var a=s.side||("front"===o?"F":"B");"A"===a&&61!=s.id&&66!=s.id?m.css("visibility","visible"):m.css("visibility","hidden"),0===r?jQuery("#screen_location .zoomout").hide():jQuery("#screen_location .zoomout").show(),h.show(),i.nanoScroller({disableResize:!0,alwaysVisible:!0}),"block"===jQuery("#nano-scroll .pane").css("display")&&i.addClass("border")}function g(){jQuery("#img_location").maphilight({strokeColor:"00ff00",fillColor:"ec931f",fillOpacity:.4,strokeWidth:1,neverOn:!1,groupBy:!1,wrapClass:!0,shadow:!0,shadowX:0,shadowY:0,shadowRadius:6,shadowColor:"ec931f",shadowOpacity:.8,shadowPosition:"outside",shadowFrom:!1})}var h=jQuery("#listlocationscroll .content"),i=jQuery("#nano-scroll"),j="#people_location i",k=_.template(jQuery("#tmpl-localization-list").html()),l=_.template(jQuery("#tmpl-polygon-map").html()),m=jQuery("#screen_location .rotate"),n=jQuery("#loadingLocations"),o="front",p="gr_1",q="m",r=0,s={},t=new c;this.getSide=function(){return o},this.setSide=function(a){o=a},this.setAge=function(a){p=a},this.setGender=function(a){q="sex_man"==a?"m":"g"},this.show=function(){r=0,a(),b()},this.rotate=function(){o="front"==o?"back":"front",this.select(s.id,!0)},this.zoomout=function(){this.select(s.top,!0)},this.selectGroup=function(){var a=jQuery(this),b=a.data("hash"),c=a.data("idloc"),d=t.get(b).data,e=!1;if(!a.hasClass("current-location")){for(var f=0,g=d.length;g>f;f++)if(d[f].id==c){e=d[f];break}e&&(jQuery("#cancel_new_symptom").trigger("click"),jQuery("#btnAddSymptome .bottom").html('"'+e.name+'"'),jQuery("#title-list-symptome .name").html(e.name),Medical.ModelLocalization.addLocalization({id:c,name:e.name,img:e.img}))}},this.select=function(a,c){var d=c?0:jQuery("#locat_"+a).attr("data-last");if(1==d){for(var e=r+"_"+o+"_"+q,f=t.get(r+"_"+o+"_"+q).data,g=!1,h=0,i=f.length;i>h;h++)if(f[h].id==a){g=f[h];break}if(!g)return;jQuery("#btnAddSymptome .bottom").html('"'+g.name+'"'),jQuery("#title-list-symptome .name").html(g.name),Medical.ModelLocalization.addLocalization({id:a,name:g.name,img:g.img,hashkey:e}),jQuery("#bcd_dia").addClass("active"),jQuery("#screen_location").fadeOut("fast",function(){jQuery("#screen_basket").fadeIn(),jQuery("#back-diagnostic").show()}),jQuery("#bcd_loc, #bcd_sex").removeClass("active"),jQuery("#bcd_dia").addClass("active").show(),jQuery("#bcd_dia_sep").show(),Medical.Settings.page=2}else r=a,b(!0)}},f=function(a){function b(a){var b=g[a];jQuery(d).append(l({location:b})),c(b.id)}function c(a){var b=e+i+a,c=e+a,d=k[b],f=jQuery("#basket-storage-"+a);if(g[c])return!d||_.isEmpty(d)?void f.html("<br /><p>выберите симптомы</p>"):void f.html(m({symptomlist:d,locationid:a}))}var d=a.el,e="lml_",f="tmpl-location-one",g={},h=!1,i="lms_",j="tmpl-symptome-list",k={},l=null,m=null,n=null,o="tmpl-location-delete",p=jQuery("#back-diagnostic"),q=function(a){h!==a&&(h=a,jQuery("#stack-location-symptome > table").removeClass("current-location"),jQuery("#loc-bl-"+h).addClass("current-location"),Medical.ModelSymptome.loadSymptome(0))},r=function(a){delete g[e+a],k[e+i+a]={},jQuery("#loc-bl-"+a).fadeOut("fast",function(){jQuery(this).remove()}),_.isEmpty(g)&&(Medical.ControllerSteps.selectNewLocation(),Medical.ModelIllness.reset(),Medical.ModelLocalization.reset(),p.hide())},s=function(a){var b=e+a,c=[];for(var d in g)d!==b&&_.isEmpty(k[e+i+g[d].id])&&c.push(d);for(var f=0,h=c.length;h>f;f+=1)jQuery("#loc-bl-"+g[c[f]].id).slideUp().remove(),delete g[c[f]]};l=_.template(jQuery("#"+f).html()),m=_.template(jQuery("#"+j).html()),n=_.template(jQuery("#"+o).html()),this.reset=function(){h=!1,g={},k={},jQuery(d).empty(),p.hide()},this.addLocalization=function(a){q(a.id);var c=e+a.id;return c in g?(s(a.id),!0):(g[c]=a,k[e+i+a.id]={},b(c),void s(a.id))},this.getLocalization=function(){return h},this.deleteLocalization=function(){var a=jQuery(this).data("id");r(a)},this.checkLocation=function(){},this.addSymptome=function(a){Medical.ModelIllness.add(a.id);var b=e+i+h,d=i+a.id;if(b in k){if(d in k[b])return!0}else k[b]={};k[b][d]=a,c(h),jQuery("#sympt_"+a.id).addClass("selected"),jQuery("#sympt_"+a.id+" .status b").prop("class","status-child-enable").html("")},this.deleteSymptome=function(a){a?a.stopPropagation&&a.stopPropagation():window.event.cancelBubble=!0;var b=jQuery(this).parent(),d=b.data("id"),f=b.data("loc"),g=e+i+f,j=i+d;delete k[g][j],h!=f&&_.isEmpty(k[g])&&r(f),c(f),Medical.ModelIllness.del(d),jQuery("#sympt_"+d).removeClass("selected"),jQuery("#sympt_"+d+" .status b").prop("class","status-child-disable").html("выбрать")},this.getSymptoms=function(){var a=e+i+h,b=k[a],c=[];return _.isEmpty(b)||jQuery.each(b,function(a){c.push(b[a].id)}),c}},g=function(b){function c(a){var b=jQuery(g);if(1!=a.rc)b.html(a.msg||"Не удалось получить список болезней.");else{Medical.Settings.debug_href=a.debughref;var c=0;l=[];for(var d=0,e=a.illness.length;e>d;d++)if(a.illness[d].ratio){var f={};f.id=a.illness[d].id,f.name=a.illness[d].name,f.ratio=a.illness[d].ratio,f.href=a.illness[d].href,f.specific=a.illness[d].specific,l.push(f),c+=a.illness[d].ratio}c=0===c?1:c;for(var i=l.length-1;i>=0;i--){var j=(100/c*l[i].ratio).toFixed(3),m="#FCD2D2",n="danger";j>=10?(m="#BCFDBC",n="success"):j>=5&&(m='#F8F8B0"',n="warning"),l[i].percent=j,l[i].color=m,l[i].wrapp=n}l.length?(b.html(k({illnesses:l})),window.diagnostica_social_modal_show=!0):(b.html(""),window.diagnostica_social_modal_show=!1)}jQuery(h).hide()}function d(){jQuery(h).hide();var a=jQuery(g);a.html(l?k({illnesses:l}):"")}function e(){if(jQuery(h).show(),l=null,_.isEmpty(f))return window.diagnostica_social_modal_show=!1,d(),!1;var b=_.values(f),e=("male"==m?"m_":"g_")+n,i="male"==m?1:2,j=a.getQueryGET(),k=!1,p={ids:b,gender:i,age:e,imt:o};return 1===b.length&&(k=Medical.ModelSymptome.getFromStorage(b[0]),k&&1!==k.impossible)?(window.diagnostica_social_modal_show=!1,jQuery(g).html("По выбраному симптому невозможно поставить диагноз.<br>Введите дополнительные симптомы."),jQuery(h).hide(),!1):void jQuery.ajax({type:"POST",url:"index.php?option=com_socdiagnostics&controller=ajaxdiagnostics&task=get_illness_list&"+j,data:p,dataType:"json",success:c,error:function(){console.log("error get illness")}})}var f={},g=b.el,h=b.wait||!1,i=b.pefix||"ims_",j=b.tmpl||"нет данных",k=null,l=null,m="male",n="gr_1",o=0;k=_.template(jQuery("#"+j).html()),this.add=function(a){f[i+a]||(f[i+a]=a,e())},this.del=function(a){if(_.isArray(a))for(var b=0,c=a.length;c>b;b++)delete f[i+a[b]];else delete f[i+a];e()},this.update=function(){e()},this.reset=function(){f={},l=null,d()},this.setGender=function(a){m="sex_man"==a?"male":"female"},this.setAge=function(a){n=a},this.setImt=function(a){o=a},this.openIllness=function(a){var b="default";Medical.Settings.specific&&(b="symptoms");var c=window.open("index.php?option=com_illness&view=folclore&layout=data&iid="+a,"_blank");c.focus()},this.showLog=function(){for(var b=_.values(f),c=("male"==m?"m_":"g_")+n,d="male"==m?1:2,e=a.getQueryGET(),g=[],h=0,i=b.length;i>h;h++)g.push("ids[]="+b[h]);var j="index.php?option=com_socdiagnostics&controller=ajaxdiagnostics&task=get_illness_list&debug=true&gender="+d+"&age="+c+"&"+g.join("&")+"&"+e,k=window.open(j,"_blank");k.focus()}},h=function(){var a=jQuery("#stack-list-symptome"),b=jQuery("#stack-btnadd-symptome"),c=jQuery("#loadSymptoms"),d=jQuery("#screen_symptoms"),e=_.template(jQuery("#tmpl-symptoms-select-list").html()),f="gr_1",g="sex_man",h={},i=function(){b.hide(),a.show(),c.show()},j=function(a){var b,c;if(jQuery.isArray(a))for(b=a.length,c=0;b>c;c+=1)h[a[c].id]=a[c]},k=function(a){return h[a]?h[a]:!1},l=function(a){var b,c=jQuery("#children_sym_"+a),d=jQuery("#sympt_"+a+" .status b");return"yes"===c.data("load")?("none"===c.css("display")?(b=c.closest(".p_wrapp").parent().children().filter(".p_wrapp"),b.find(".sub_children").not(c).slideUp(function(){b.find(".status-parent-expand").not(d).prop("class","status-parent-disable")}),c.slideDown(function(){d.prop("class","status-parent-expand"===d.prop("class")?"status-parent-disable":"status-parent-expand")})):(c.slideUp(function(){d.prop("class","status-parent-expand"===d.prop("class")?"status-parent-disable":"status-parent-expand")}),c.find(".sub_children").slideUp(function(){c.find(".status-parent-expand").prop("class","status-parent-disable")})),!0):!1},m=function(a){if(a.rc<0)d.html(a.html).show();else if(1==a.rc){var b,f="",g="";1!==a.parentid?(b=jQuery("#children_sym_"+a.parentid),b.data("load","yes")):b=d,a.root&&a.root.length?(j(a.root),g=e({symptomelist:a.root,parent:a.parentid}),f+=g):f=a.html,"yes"===b.data("load")?(b.html(f),l(a.parentid)):b.html(f).show().scrollTop(0)}else 2==a.rc&&d.html(a.html).show().scrollTop(0);c.hide()};this.setAge=function(a){f=a},this.setGender=function(a){g=a},this.cancel=function(){b.show(),c.hide(),a.hide(),d.empty()},this.getFromStorage=function(a){return k(a)},this.select=function(a){var b=k(a);b&&Medical.ModelLocalization.addSymptome(b)},this.loadSymptome=function(a){if(a="number"==typeof a?a||!1:a.data.idParent,!l(a)){i();var b={};b.sex=g,b.symptoms=Medical.ModelLocalization.getSymptoms(),b.location=Medical.ModelLocalization.getLocalization(),a&&(b.parent=a);var d="params="+jQuery.toJSON(b);jQuery.ajax({type:"POST",url:"index.php?option=com_socdiagnostics&controller=ajaxdiagnostics&task=get_root_symptome",data:d,dataType:"json",success:m,error:function(){c.hide()}})}}};window.Medical.History=new b,window.Medical.Debuger=a,window.Medical.ModelSelectLoc=new e,window.Medical.ControllerSteps=new d,window.Medical.ModelLocalization=new f({el:"#stack-location-symptome"}),window.Medical.ModelSymptome=new h,window.Medical.ModelIllness=new g({el:"#illness-storage",tmpl:"tmpl-illness-list",wait:"#loadingIllness"}),jQuery("div.btnSex").click(Medical.ControllerSteps.selectGender),jQuery("#btnAddSymptome").click({idParent:!1},Medical.ModelSymptome.loadSymptome),jQuery("#cancel_new_symptom").click(Medical.ModelSymptome.cancel),jQuery("#valid-form-and-next").click(Medical.ControllerSteps.goToLocation),jQuery("#stack-location-symptome").on("click",".symptome-btn img.del",Medical.ModelLocalization.deleteSymptome),jQuery("#stack-location-symptome").on("click",".delete-loc",Medical.ModelLocalization.deleteLocalization),jQuery("#stack-location-symptome").on("click","table",Medical.ModelSelectLoc.selectGroup),jQuery("#listlocationscroll .content").on("mouseover",".btn_symptome .name_sympt",function(){var a=jQuery(this).parent().attr("id");jQuery("#location_map ."+a).mouseover()}).on("mouseout",".btn_symptome .name_sympt",function(){var a=jQuery(this).parent().attr("id");jQuery("#location_map ."+a).mouseout()}).on("click",".btn_symptome",function(){var a=jQuery(this).attr("data-id");Medical.ModelSelectLoc.select(a)}),jQuery("#location_map").on("mouseover","area",function(){var a=jQuery(this).attr("data-id");jQuery("#locat_"+a).addClass("hover")}).on("mouseout","area",function(){var a=jQuery(this).attr("data-id");jQuery("#locat_"+a).removeClass("hover")}).on("click","area",function(){var a=jQuery(this).attr("data-id");Medical.ModelSelectLoc.select(a)}),jQuery("#age_patient li").on("click",function(){var a=jQuery(this),b=a.hasClass("active");b||(jQuery("#age_patient li").removeClass("active"),a.addClass("active"),a.find("input").trigger("click"))}),jQuery("#age_patient input[name=age_patient]").on("click",function(){jQuery("#weight_patient").trigger("keyup")}),jQuery("#weight_patient, #growth_patient").on("change, keyup",function(){var a=Medical.ControllerSteps.isDigit(jQuery("#growth_patient").val()),b=Medical.ControllerSteps.isDigit(jQuery("#weight_patient").val()),c=jQuery("input[name=age_patient]:checked"),d=c.val(),e=0,f="";return a===!1||b===!1||10>a?void jQuery("#weight_koef").html(f):(a/=100,e=b/(a*a),"gr_1"===d&&(e*=1.6),"gr_2"===d&&(e*=1.4),"gr_3"===d&&(e*=1.2),e=1*e.toFixed(2),f=e>0&&16>=e?"ИМТ = "+e+" (Выраженный дефицит массы тела)":e>16&&18.5>=e?"ИМТ = "+e+" (Недостаточная (дефицит) масса тела)":e>18.5&&25>=e?"ИМТ = "+e+" (Норма)":e>25&&30>=e?"ИМТ = "+e+" (Избыточная масса тела (предожирение))":e>30&&35>=e?"ИМТ = "+e+" (Ожирение первой степени)":e>35&&40>=e?"ИМТ = "+e+" (Ожирение второй степени)":e>40&&2e3>e?"ИМТ = "+e+" (Ожирение третьей степени (морбидное))":"",Medical.ModelIllness.setImt(e),void jQuery("#weight_koef").html(f))}),jQuery("#illness-storage").on("click",".illnes_in_diagnostic",function(){jQuery(this).colorbox({height:"550px",width:"700px"})}),jQuery("#header_wrap a, #top a, .contentheading a").on("click",function(a){window.diagnostica_social_modal_show&&(a.preventDefault(),window.diagnostica_social_modal_href=jQuery(this).attr("href"),jQuery("#social-msg, #social-msg-back").show(),jQuery(document).idleTimer("destroy"))}),window.diagnostica_social_modal_show=!1,window.diagnostica_social_modal_href=!1,jQuery(document).idleTimer({timeout:5e3,idle:!0}),jQuery(document).on("idle.idleTimer",function(){window.diagnostica_social_modal_show&&(jQuery("#social-msg, #social-msg-back").show(),jQuery(document).idleTimer("destroy"))}),jQuery("#social-msg").on("click","button, #btn-close-share",function(){jQuery(document).idleTimer("destroy"),jQuery("#social-msg, #social-msg-back").hide(),window.diagnostica_social_modal_href&&(location.href=window.diagnostica_social_modal_href)})});
//# sourceMappingURL=diagnostic.js.map